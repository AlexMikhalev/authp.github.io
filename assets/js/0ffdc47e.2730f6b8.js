"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1837],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return h}});var i=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=i.createContext({}),s=function(e){var t=i.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=s(e.components);return i.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},p=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=s(n),h=o,k=p["".concat(c,".").concat(h)]||p[h]||u[h]||a;return n?i.createElement(k,r(r({ref:t},d),{},{components:n})):i.createElement(k,r({ref:t},d))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=p;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var s=2;s<a;s++)r[s]=n[s];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}p.displayName="MDXCreateElement"},6640:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return c},metadata:function(){return s},toc:function(){return d},default:function(){return p}});var i=n(7462),o=n(3366),a=(n(7294),n(3905)),r=["components"],l={sidebar_position:40},c="Authorization Cookie",s={unversionedId:"authenticate/auth-cookie",id:"authenticate/auth-cookie",isDocsHomePage:!1,title:"Authorization Cookie",description:"Intra-Domain Cookies",source:"@site/docs/authenticate/auth-cookie.md",sourceDirName:"authenticate",slug:"/authenticate/auth-cookie",permalink:"/docs/authenticate/auth-cookie",editUrl:"https://github.com/authp/authp.github.io/edit/main/docs/authenticate/auth-cookie.md",tags:[],version:"current",sidebarPosition:40,frontMatter:{sidebar_position:40},sidebar:"tutorialSidebar",previous:{title:"Authentication Portal",permalink:"/docs/authenticate/auth-portal"},next:{title:"User Transforms",permalink:"/docs/authenticate/user-transforms"}},d=[{value:"Intra-Domain Cookies",id:"intra-domain-cookies",children:[],level:2},{value:"JWT Tokens",id:"jwt-tokens",children:[{value:"Auto-Generated Encryption Keys",id:"auto-generated-encryption-keys",children:[],level:3},{value:"Encryption Key Configuration",id:"encryption-key-configuration",children:[{value:"Shared Key",id:"shared-key",children:[],level:4}],level:3}],level:2}],u={toc:d};function p(e){var t=e.components,n=(0,o.Z)(e,r);return(0,a.kt)("wrapper",(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"authorization-cookie"},"Authorization Cookie"),(0,a.kt)("h2",{id:"intra-domain-cookies"},"Intra-Domain Cookies"),(0,a.kt)("p",null,"The following ",(0,a.kt)("inlineCode",{parentName:"p"},"Caddyfile")," settings define the scope of the cookies issued by\nthe plugin. Specifically, what URLs the cookies should be sent to.\nSee ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies"},"MDN - Using HTTP cookies - Define where cookies are sent"),"\nfor more information."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cookie domain <domain>"),": adds the ",(0,a.kt)("strong",{parentName:"li"},"Domain")," attribute to a cookie. It\ndetermines which hosts are allowed to receive the cookie. By default,\nthe domain is not included."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cookie path <path>")," (optional): adds the ",(0,a.kt)("strong",{parentName:"li"},"Path")," attribute to a cookie.\nIt determines the URL path that must exist in the requested URL in order\nto send  the Cookie header. The default is ",(0,a.kt)("inlineCode",{parentName:"li"},"/"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cookie lifetime"),' (optional): sets the number of seconds until the cookie\nexpires. The directive sets "Max-Age" cookie attribute.'),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cookie samesite <lax|strict|none>"),": specifies SameSite strategy."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cookie insecure <on|off>"),": Allows sending cookies over HTTP. By default,\nit is disabled.")),(0,a.kt)("h2",{id:"jwt-tokens"},"JWT Tokens"),(0,a.kt)("p",null,"The plugin issues JWT tokens to authenticated users. The tokens\ncontains user attributes, e.g. name, email, avatar, etc. They also\ncontains roles. The roles are used to authorize user access with\n",(0,a.kt)("inlineCode",{parentName:"p"},"authorize")," plugin."),(0,a.kt)("p",null,"By default, in addition to the roles configured by an authentication provider,\nthe plugin issues one of the three roles to a user."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"authp/admin"),": this is the admin user. It must be granted by authentication\nprovider or added to a user via ",(0,a.kt)("inlineCode",{parentName:"li"},"transform user")," directive"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"authp/user"),": the user can access ",(0,a.kt)("inlineCode",{parentName:"li"},"/settings")," endpoint. It must be granted\nby authentication provider or added to a user via ",(0,a.kt)("inlineCode",{parentName:"li"},"transform user")," directive"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"authp/guest"),": can access portal only. This is the default role assigned by\nthe portal to a user when neither ",(0,a.kt)("inlineCode",{parentName:"li"},"authp/admin")," nor ",(0,a.kt)("inlineCode",{parentName:"li"},"authp/user")," are being\nassigned")),(0,a.kt)("p",null,"The plugin supports the issuance and verification of RSA, ECDSA, and shared keys.\nSee docs ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/greenpau/caddy-authorize#token-verification"},"here"),"."),(0,a.kt)("h3",{id:"auto-generated-encryption-keys"},"Auto-Generated Encryption Keys"),(0,a.kt)("p",null,"By default, if there is no ",(0,a.kt)("inlineCode",{parentName:"p"},"crypto key")," directive, the plugin auto-generated\nECDSA key pair for signing and verification of tokens. The key pair changes\nwith each restart of the plugin."),(0,a.kt)("p",null,"In this case, there is no need to define ",(0,a.kt)("inlineCode",{parentName:"p"},"crypto key")," directive in ",(0,a.kt)("inlineCode",{parentName:"p"},"authorize")," plugin\nbecause the two plugins would know about the keypair."),(0,a.kt)("p",null,"This is a perfect option for standalone servers."),(0,a.kt)("h3",{id:"encryption-key-configuration"},"Encryption Key Configuration"),(0,a.kt)("h4",{id:"shared-key"},"Shared Key"),(0,a.kt)("p",null,"The following configuration instructs the plugin to sign/verify token\nwith shared key ",(0,a.kt)("inlineCode",{parentName:"p"},"428f41ab-67ec-47d1-8633-bcade9dcc7ed")," and add key id of\n",(0,a.kt)("inlineCode",{parentName:"p"},"a2f19072b6d6")," to the token's header. It uses the default token lifetime\nof 900 seconds (15 minutes). The name of the token is ",(0,a.kt)("inlineCode",{parentName:"p"},"access_token"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"authp {\n  crypto key a2f19072b6d6 sign-verify 428f41ab-67ec-47d1-8633-bcade9dcc7ed\n}\n")),(0,a.kt)("p",null,"The corresponding ",(0,a.kt)("inlineCode",{parentName:"p"},"authorize")," plugin config is:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"authorize {\n  crypto key a2f19072b6d6 verify 428f41ab-67ec-47d1-8633-bcade9dcc7ed\n}\n")),(0,a.kt)("p",null,"The following configuration instructs the plugin to sign/verify token\nwith shared key ",(0,a.kt)("inlineCode",{parentName:"p"},"428f41ab-67ec-47d1-8633-bcade9dcc7ed")," and add key id of\n",(0,a.kt)("inlineCode",{parentName:"p"},"a2f19072b6d6")," to the token's header. It uses the default token lifetime\nof 1800 seconds (900 minutes). The name of the token is ",(0,a.kt)("inlineCode",{parentName:"p"},"JWT_TOKEN"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"authp {\n  crypto default token name JWT_TOKEN\n  crypto default token lifetime 1800\n  crypto key a2f19072b6d6 sign-verify 428f41ab-67ec-47d1-8633-bcade9dcc7ed\n}\n")),(0,a.kt)("p",null,"The corresponding ",(0,a.kt)("inlineCode",{parentName:"p"},"authorize")," plugin config is:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"authorize {\n  crypto key a2f19072b6d6 verify 428f41ab-67ec-47d1-8633-bcade9dcc7ed\n}\n")),(0,a.kt)("p",null,"The following configuration instructs the plugin to sign/verify token\nwith shared key ",(0,a.kt)("inlineCode",{parentName:"p"},"428f41ab-67ec-47d1-8633-bcade9dcc7ed")," and add key id of\n",(0,a.kt)("inlineCode",{parentName:"p"},"a2f19072b6d6")," to the token's header. It uses the default token lifetime\nof 1800 seconds (900 minutes). The name of the token is ",(0,a.kt)("inlineCode",{parentName:"p"},"JWT_TOKEN"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"authp {\n  crypto key sign-verify 428f41ab-67ec-47d1-8633-bcade9dcc7ed\n}\n")),(0,a.kt)("p",null,"The corresponding ",(0,a.kt)("inlineCode",{parentName:"p"},"authorize")," plugin config is:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"authorize {\n  crypto key verify 428f41ab-67ec-47d1-8633-bcade9dcc7ed\n}\n")))}p.isMDXComponent=!0}}]);