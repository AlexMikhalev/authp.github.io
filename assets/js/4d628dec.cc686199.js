"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2313],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return d}});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var p=n.createContext({}),u=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},c=function(e){var t=u(e.components);return n.createElement(p.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},k=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,l=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),k=u(a),d=o,m=k["".concat(p,".").concat(d)]||k[d]||s[d]||l;return a?n.createElement(m,r(r({ref:t},c),{},{components:a})):n.createElement(m,r({ref:t},c))}));function d(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var l=a.length,r=new Array(l);r[0]=k;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:o,r[1]=i;for(var u=2;u<l;u++)r[u]=a[u];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},3090:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return i},contentTitle:function(){return p},metadata:function(){return u},toc:function(){return c},default:function(){return k}});var n=a(7462),o=a(3366),l=(a(7294),a(3905)),r=["components"],i={},p="Okta",u={unversionedId:"authenticate/oauth/backend-oauth2-0001-okta",id:"authenticate/oauth/backend-oauth2-0001-okta",isDocsHomePage:!1,title:"Okta",description:'Create an "Application," by browsing to "Applications" and clicking',source:"@site/docs/authenticate/oauth/81-backend-oauth2-0001-okta.md",sourceDirName:"authenticate/oauth",slug:"/authenticate/oauth/backend-oauth2-0001-okta",permalink:"/docs/authenticate/oauth/backend-oauth2-0001-okta",editUrl:"https://github.com/authp/authp.github.io/edit/main/docs/authenticate/oauth/81-backend-oauth2-0001-okta.md",tags:[],version:"current",sidebarPosition:81,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Generic Provider",permalink:"/docs/authenticate/oauth/backend-oauth2-0000-generic"},next:{title:"Google Identity Platform",permalink:"/docs/authenticate/oauth/backend-oauth2-0002-google"}},c=[],s={toc:c};function k(e){var t=e.components,i=(0,o.Z)(e,r);return(0,l.kt)("wrapper",(0,n.Z)({},s,i,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"okta"},"Okta"),(0,l.kt)("p",null,'Create an "Application," by browsing to "Applications" and clicking\n"Add Application" button.'),(0,l.kt)("p",null,'For a website, the choice is "Web".'),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Okta Developer - New App Choice",src:a(7574).Z})),(0,l.kt)("p",null,"Provided your application is running on localhost port 8443, provide the following\ninformation:"),(0,l.kt)("p",null,"Base URI entries:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"https://myapp.localdomain.local:8443/")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"https://localhost:8443/"))),(0,l.kt)("p",null,"Login redirect URIs:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"https://myapp.localdomain.local:8443/auth/oauth2/okta/authorization-code-callback")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"https://localhost:8443/auth/oauth2/okta/authorization-code-callback"))),(0,l.kt)("p",null,"Logout redirect URIs:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"https://myapp.localdomain.local:8443/auth/logout")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"https://localhost:8443/auth/logout"))),(0,l.kt)("p",null,"Group Assignments:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Everyone"),(0,l.kt)("li",{parentName:"ul"},"Viewer"),(0,l.kt)("li",{parentName:"ul"},"Editor"),(0,l.kt)("li",{parentName:"ul"},"Administrator")),(0,l.kt)("p",null,"Grant type allowed:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Client acting on behalf of itself",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Client Credentials: No"))),(0,l.kt)("li",{parentName:"ul"},"Client acting on behalf of a user",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Authorization Code: Yes"),(0,l.kt)("li",{parentName:"ul"},"Refresh Token: No"),(0,l.kt)("li",{parentName:"ul"},"Implicit (Hybrid): No")))),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Okta Developer - New App Setup",src:a(869).Z})),(0,l.kt)("p",null,"Review the newly created application."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Okta Developer - Settings - General",src:a(4748).Z})),(0,l.kt)("p",null,"Store the credentials securely."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Okta Developer - Settings - Client Credentials",src:a(5436).Z})),(0,l.kt)("p",null,"Review default Sign On Policy."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Okta Developer - Settings - Sign On",src:a(5914).Z})),(0,l.kt)("p",null,"By default, the default Authorization Server has no ",(0,l.kt)("inlineCode",{parentName:"p"},"groups")," scope."),(0,l.kt)("p",null,'Therefore, browse to "API", "Authorization Servers" and select "default".'),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Okta Developer - API",src:a(8087).Z})),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Okta Developer - API",src:a(2110).Z})),(0,l.kt)("p",null,'Next, browse to "Scopes" and click "Add Scope".'),(0,l.kt)("p",null,'Fill out the "Add Scope" form:'),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Name: ",(0,l.kt)("inlineCode",{parentName:"li"},"groups")),(0,l.kt)("li",{parentName:"ul"},"Description: ",(0,l.kt)("inlineCode",{parentName:"li"},"This allows the app to view your group memberships.")),(0,l.kt)("li",{parentName:"ul"},'Check "Set as a default scope"'),(0,l.kt)("li",{parentName:"ul"},'Check "Include in public metadata"')),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Okta Developer - Add Scope",src:a(1844).Z})),(0,l.kt)("p",null,'Next, browse to "Claims" and click "Add Claim".'),(0,l.kt)("p",null,'Fill out the "Add Claim" form:'),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Name: ",(0,l.kt)("inlineCode",{parentName:"li"},"groups")),(0,l.kt)("li",{parentName:"ul"},'Include in token type: "ID Token", "Always"'),(0,l.kt)("li",{parentName:"ul"},"Value type: Groups"),(0,l.kt)("li",{parentName:"ul"},"Filter: Matches ",(0,l.kt)("inlineCode",{parentName:"li"},".*")," regex"),(0,l.kt)("li",{parentName:"ul"},'Include in: The "groups" scope')),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Okta Developer - Add Scope",src:a(7487).Z})),(0,l.kt)("p",null,"Next, review ",(0,l.kt)("a",{parentName:"p",href:"https://developer.okta.com/docs/reference/api/oidc/#get-started"},"Okta OpenID Connect and OAuth 2.0 API - Get Started"),"."),(0,l.kt)("p",null,"The Caddyfile snipper for Okta OAuth 2.0 backend is as follows."),(0,l.kt)("p",null,"Based on the below configuration, Okta endpoint is ",(0,l.kt)("inlineCode",{parentName:"p"},"/auth/oauth2/okta"),". If a user\nbrowses to the endpoint, the user will be redirected to Okta."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"127.0.0.1, localhost {\n  route /auth* {\n    authp {\n      backends {\n        okta_oauth2_backend {\n          method oauth2\n          realm okta\n          provider okta\n          domain_name dev-680653.okta.com\n          client_id 0oa121qw81PJW0Tj34x7\n          client_secret b3aJC5E59hU18YKC7Yca3994F4qFhWiAo_ZojanF\n          server_id default\n          scopes openid email profile groups\n        }\n")),(0,l.kt)("p",null,"Next, protect a route, e.g. ",(0,l.kt)("inlineCode",{parentName:"p"},"/sso/oauth2/okta*"),". When a user accesses the page, the\nthe user will be redirected to ",(0,l.kt)("inlineCode",{parentName:"p"},"/auth/oauth2/okta")," and, then, to Okta. Once authenticated,\nthe user will be redirected back to ",(0,l.kt)("inlineCode",{parentName:"p"},"/sso/oauth2/okta..."),", i.e. back to the path the user\ncame from."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'  route /sso/oauth2/okta* {\n    authorize {\n      set auth url /auth/oauth2/okta\n    }\n    respond * "okta oauth2 sso" 200\n  }\n')),(0,l.kt)("p",null,"Provided the Okta domain is ",(0,l.kt)("inlineCode",{parentName:"p"},"dev-680653.okta.com"),", the authorization server is\n",(0,l.kt)("inlineCode",{parentName:"p"},"default"),", and Client ID is ",(0,l.kt)("inlineCode",{parentName:"p"},"0oa121qw81PJW0Tj34x7"),", check OpenID configuration:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X GET "https://dev-680653.okta.com/oauth2/default/.well-known/openid-configuration?client_id=0oa121qw81PJW0Tj34x7" | jq\n')),(0,l.kt)("p",null,"By default, the plugin logs public keys from ",(0,l.kt)("inlineCode",{parentName:"p"},"keys")," endpoint."))}k.isMDXComponent=!0},4748:function(e,t,a){t.Z=a.p+"assets/images/oauth2_okta_app_settings_01-cb8aab2747db59c6d9da9477c631aa52.png"},5436:function(e,t,a){t.Z=a.p+"assets/images/oauth2_okta_app_settings_02-329a69e1ff770d7a21ae518e72f71592.png"},5914:function(e,t,a){t.Z=a.p+"assets/images/oauth2_okta_app_settings_03-16b1704a792f91f2d4d9915400fc2ca0.png"},869:function(e,t,a){t.Z=a.p+"assets/images/oauth2_okta_new_app-91fc606bb0ef98a6c2ba4723b674009d.png"},7574:function(e,t,a){t.Z=a.p+"assets/images/oauth2_okta_new_app_choice-032773eae345af9c5899692f2414699a.png"},8087:function(e,t,a){t.Z=a.p+"assets/images/okta_configure_scope_01-9de32f739e34786808d75ff95f056b64.png"},2110:function(e,t,a){t.Z=a.p+"assets/images/okta_configure_scope_02-852aa26443d9677e26cef7f321e9ffc4.png"},1844:function(e,t,a){t.Z=a.p+"assets/images/okta_configure_scope_03-9460eda92fb8c8ed5be0b68e13f23c63.png"},7487:function(e,t,a){t.Z=a.p+"assets/images/okta_configure_scope_04-9ac3bbb1aed49cfa8f65a32fb353b6a5.png"}}]);