<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Auth with Caddy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Auth with Caddy Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-MVS6492XVX","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Authorization Cookie | Auth with Caddy</title><meta data-react-helmet="true" property="google-site-verification" content="VnGnUPzlKD0BatpTv3Ik0ax09Ph7WOggw6Fu_OF_2M0"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://authp.github.io/docs/authenticate/auth-cookie"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Authorization Cookie | Auth with Caddy"><meta data-react-helmet="true" name="description" content="Intra-Domain Cookies"><meta data-react-helmet="true" property="og:description" content="Intra-Domain Cookies"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://authp.github.io/docs/authenticate/auth-cookie"><link data-react-helmet="true" rel="alternate" href="https://authp.github.io/docs/authenticate/auth-cookie" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://authp.github.io/docs/authenticate/auth-cookie" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.cd819fb5.css">
<link rel="preload" href="/assets/js/runtime~main.121425b0.js" as="script">
<link rel="preload" href="/assets/js/main.729ee801.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Auth Portal Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/logo.svg" alt="Auth Portal Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Auth with Caddy</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/authenticate/intro">Authenticate</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/authorize/intro">Authorize</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/greenpau/caddy-auth-portal/issues/new/choose" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link button button--secondary"><span>ðŸ’¡  Ask Questions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Authenticate</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/authenticate/intro">Auth Portal Plugin Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/authenticate/auth-portal">Authentication Portal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/authenticate/auth-cookie">Authorization Cookie</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/authenticate/user-transforms">User Transforms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/authenticate/usage-examples">Usage Examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/authenticate/auth-methods">Authentication Methods</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/authenticate/ui-features">User Interface Features</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Local Backend</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">LDAP Backend</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">SAML Backend</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">OAuth 2.0 Backend</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">X.509 Backend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/authenticate/misc">Miscellaneous</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Authorize</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Authorization Cookie</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="intra-domain-cookies">Intra-Domain Cookies<a aria-hidden="true" class="hash-link" href="#intra-domain-cookies" title="Direct link to heading">â€‹</a></h2><p>The following <code>Caddyfile</code> settings define the scope of the cookies issued by
the plugin. Specifically, what URLs the cookies should be sent to.
See <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies" target="_blank" rel="noopener noreferrer">MDN - Using HTTP cookies - Define where cookies are sent</a>
for more information.</p><ul><li><code>cookie domain &lt;domain&gt;</code>: adds the <strong>Domain</strong> attribute to a cookie. It
determines which hosts are allowed to receive the cookie. By default,
the domain is not included.</li><li><code>cookie path &lt;path&gt;</code> (optional): adds the <strong>Path</strong> attribute to a cookie.
It determines the URL path that must exist in the requested URL in order
to send  the Cookie header. The default is <code>/</code>.</li><li><code>cookie lifetime</code> (optional): sets the number of seconds until the cookie
expires. The directive sets &quot;Max-Age&quot; cookie attribute.</li><li><code>cookie samesite &lt;lax|strict|none&gt;</code>: specifies SameSite strategy.</li><li><code>cookie insecure &lt;on|off&gt;</code>: Allows sending cookies over HTTP. By default,
it is disabled.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="jwt-tokens">JWT Tokens<a aria-hidden="true" class="hash-link" href="#jwt-tokens" title="Direct link to heading">â€‹</a></h2><p>The plugin issues JWT tokens to authenticated users. The tokens
contains user attributes, e.g. name, email, avatar, etc. They also
contains roles. The roles are used to authorize user access with
<code>authorize</code> plugin.</p><p>By default, in addition to the roles configured by an authentication provider,
the plugin issues one of the three roles to a user.</p><ul><li><code>authp/admin</code>: this is the admin user. It must be granted by authentication
provider or added to a user via <code>transform user</code> directive</li><li><code>authp/user</code>: the user can access <code>/settings</code> endpoint. It must be granted
by authentication provider or added to a user via <code>transform user</code> directive</li><li><code>authp/guest</code>: can access portal only. This is the default role assigned by
the portal to a user when neither <code>authp/admin</code> nor <code>authp/user</code> are being
assigned</li></ul><p>The plugin supports the issuance and verification of RSA, ECDSA, and shared keys.
See docs <a href="https://github.com/greenpau/caddy-authorize#token-verification" target="_blank" rel="noopener noreferrer">here</a>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="auto-generated-encryption-keys">Auto-Generated Encryption Keys<a aria-hidden="true" class="hash-link" href="#auto-generated-encryption-keys" title="Direct link to heading">â€‹</a></h3><p>By default, if there is no <code>crypto key</code> directive, the plugin auto-generated
ECDSA key pair for signing and verification of tokens. The key pair changes
with each restart of the plugin.</p><p>In this case, there is no need to define <code>crypto key</code> directive in <code>authorize</code> plugin
because the two plugins would know about the keypair.</p><p>This is a perfect option for standalone servers.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="encryption-key-configuration">Encryption Key Configuration<a aria-hidden="true" class="hash-link" href="#encryption-key-configuration" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="shared-key">Shared Key<a aria-hidden="true" class="hash-link" href="#shared-key" title="Direct link to heading">â€‹</a></h4><p>The following configuration instructs the plugin to sign/verify token
with shared key <code>428f41ab-67ec-47d1-8633-bcade9dcc7ed</code> and add key id of
<code>a2f19072b6d6</code> to the token&#x27;s header. It uses the default token lifetime
of 900 seconds (15 minutes). The name of the token is <code>access_token</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">authp {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crypto key a2f19072b6d6 sign-verify 428f41ab-67ec-47d1-8633-bcade9dcc7ed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The corresponding <code>authorize</code> plugin config is:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">authorize {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crypto key a2f19072b6d6 verify 428f41ab-67ec-47d1-8633-bcade9dcc7ed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The following configuration instructs the plugin to sign/verify token
with shared key <code>428f41ab-67ec-47d1-8633-bcade9dcc7ed</code> and add key id of
<code>a2f19072b6d6</code> to the token&#x27;s header. It uses the default token lifetime
of 1800 seconds (900 minutes). The name of the token is <code>JWT_TOKEN</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">authp {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crypto default token name JWT_TOKEN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crypto default token lifetime 1800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crypto key a2f19072b6d6 sign-verify 428f41ab-67ec-47d1-8633-bcade9dcc7ed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The corresponding <code>authorize</code> plugin config is:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">authorize {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crypto key a2f19072b6d6 verify 428f41ab-67ec-47d1-8633-bcade9dcc7ed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The following configuration instructs the plugin to sign/verify token
with shared key <code>428f41ab-67ec-47d1-8633-bcade9dcc7ed</code> and add key id of
<code>a2f19072b6d6</code> to the token&#x27;s header. It uses the default token lifetime
of 1800 seconds (900 minutes). The name of the token is <code>JWT_TOKEN</code>.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">authp {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crypto key sign-verify 428f41ab-67ec-47d1-8633-bcade9dcc7ed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The corresponding <code>authorize</code> plugin config is:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">authorize {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  crypto key verify 428f41ab-67ec-47d1-8633-bcade9dcc7ed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/authp/authp.github.io/edit/main/docs/authenticate/auth-cookie.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/authenticate/auth-portal"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Authentication Portal</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/authenticate/user-transforms"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">User Transforms<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#intra-domain-cookies" class="table-of-contents__link toc-highlight">Intra-Domain Cookies</a></li><li><a href="#jwt-tokens" class="table-of-contents__link toc-highlight">JWT Tokens</a><ul><li><a href="#auto-generated-encryption-keys" class="table-of-contents__link toc-highlight">Auto-Generated Encryption Keys</a></li><li><a href="#encryption-key-configuration" class="table-of-contents__link toc-highlight">Encryption Key Configuration</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/authenticate/intro">Authenticate</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/authorize/intro">Authorize</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://caddy.community" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Caddy Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/GreenbergTech" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/authp/authp.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Paul Greenberg @greenpau.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.121425b0.js"></script>
<script src="/assets/js/main.729ee801.js"></script>
</body>
</html>